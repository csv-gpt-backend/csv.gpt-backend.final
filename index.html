<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>HHHHAsistente Lexium</title>
<style>
body{margin:0;background:#fff;font-family:Arial,sans-serif;text-align:center}
header{display:flex;justify-content:space-between;align-items:center;padding:10px}
.video-container{position:relative;display:flex;justify-content:center;align-items:center}
.left-img,.right-img{width:10%;height:auto}
video{width:65%;border:none}
textarea{width:80%;height:40px;margin-top:10px;font-size:16px}
button,select{margin:5px;padding:8px 14px;font-size:14px}
#respuesta{margin-top:10px;padding:10px;width:80%;margin-left:auto;margin-right:auto;text-align:left;border-top:1px solid #ccc}
</style>
</head>
<body>
<header>
  <img src="left.png" class="left-img">
  <button id="historialBtn">Historial</button>
  <img src="right.png" class="right-img">
</header>

<div class="video-container">
  <video id="video" muted>
    <source src="https://xsmr71ubix2w6tve.public.blob.vercel-storage.com/OLIVIA%20IN%20CASUAL.mp4" type="video/mp4">
  </video>
</div>

<textarea id="pregunta" placeholder="Escribe tu pregunta (ej: explica la asertividad según evaluacion.txt, o promedio de AUTOESTIMA por paralelo)"></textarea><br>

<button id="enviarBtn" title="Envía la pregunta al servidor">Enviar</button>
<button id="dictarBtn" title="Dictar pregunta por micrófono">Dictar</button>
<button id="pararBtn" title="Parar/Reanudar voz y video">Parar/Activar voz y video</button>
<button id="reproBtn" title="Reproducir nuevamente la última respuesta">Reproducir nuevamente</button>
<button id="nuevaBtn" title="Iniciar nueva sesión">Nueva sesión</button>
<button id="limpiarBtn" title="Limpiar área de respuesta">Limpiar</button>
<select id="exportarSel" title="Exportar resultados">
  <option value="">Exportar...</option>
  <option value="pdf">PDF</option>
  <option value="xls">XLS</option>
  <option value="doc">DOC</option>
</select>

<div id="respuesta"></div>

<script>
const API_BASE = "https://lexium-api-383217514425.southamerica-west1.run.app/api";
let lastText = "";
let speaking=false;

async function enviar(){
  const q=document.getElementById("pregunta").value.trim();
  if(!q) return;
  const res=await fetch(`${API_BASE}/answer?q=${encodeURIComponent(q)}`);
  const data=await res.json();
  lastText = data.general;
  document.getElementById("respuesta").innerText=data.general||"";
  // hablar con voz femenina
  speak(lastText);
}
function speak(text){
  const utter=new SpeechSynthesisUtterance(text);
  utter.lang="es-MX";
  utter.voice=speechSynthesis.getVoices().find(v=>v.lang.includes("es") && v.name.toLowerCase().includes("female"))||null;
  utter.onstart=()=>{document.getElementById("video").play();}
  utter.onend=()=>{document.getElementById("video").pause();}
  speechSynthesis.speak(utter);
  speaking=true;
}
document.getElementById("enviarBtn").onclick=enviar;
document.getElementById("limpiarBtn").onclick=()=>{document.getElementById("respuesta").innerText="";}
document.getElementById("reproBtn").onclick=()=>{if(lastText) speak(lastText);}
document.getElementById("pararBtn").onclick=()=>{
  if(speaking){
    speechSynthesis.cancel();
    document.getElementById("video").pause();
    speaking=false;
  }else if(lastText){
    speak(lastText);
  }
};
</script>
</body>
</html>

